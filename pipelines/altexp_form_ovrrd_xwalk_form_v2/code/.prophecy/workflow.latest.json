{
  "metainfo" : {
    "migrationVersions" : {
      "gemBuilderVersion" : "v1"
    },
    "codeGenConfiguration" : {
      "editableConfig" : false,
      "plibVersion" : {
        "mavenVersion" : "7.1.83"
      }
    },
    "id" : "CAG_override_test",
    "uri" : "pipelines/altexp_form_ovrrd_xwalk_form_v2",
    "pipelineSettingsInfo" : {
      "hasApplication" : false
    },
    "language" : "scala",
    "fabricId" : "1593",
    "frontEndLanguage" : "scala",
    "mode" : "batch",
    "udfs" : {
      "language" : "scala",
      "udfs" : [ ],
      "functionPackageName" : "hariprophecyioteam.transpilermaltexpansion.functions",
      "sharedFunctionPackageNames" : [ "io.prophecy.scalagems.functions", "io.prophecy.warehousegems.functions" ],
      "initialCode" : "def op_fl_nn_condition(\n  AI_SERIAL_HOME: Column, \n  OUTPUT_FILE_PREFIX: Column,\n  ENV_NM: Column,\n  BUSINESS_DATE: Column\n) = when(\n    ((isnull(col(\"carrier\")).and(isnull(col(\"account\")))).and(isnull(col(\"group\")))).and(isnull(col(\"run_eff_dt\"))),\n    concat(\n      AI_SERIAL_HOME,\n      lit(\"/deliver/.\"),\n      lit(\"/\"),\n      OUTPUT_FILE_PREFIX,\n      lit(\"form.C.\"),\n      ENV_NM,\n      lit(\".\"),\n      col(\"customer_name\"),\n      lit(\".\"),\n      regexp_replace(col(\"formulary_name\"), lit(\" +\"), lit(\"-\")),\n      lit(\".NULL_BASE_LINE.\"),\n      BUSINESS_DATE,\n      lit(\".dat\")\n    )\n  ).when(\n      ((isnull(col(\"carrier\")).and(isnull(col(\"account\")))).and(isnull(col(\"group\")))).and(!isnull(col(\"run_eff_dt\"))),\n      concat(\n        AI_SERIAL_HOME,\n        lit(\"/deliver/.\"),\n        lit(\"/\"),\n        OUTPUT_FILE_PREFIX,\n        lit(\"form.F.\"),\n        ENV_NM,\n        lit(\".\"),\n        col(\"customer_name\"),\n        lit(\".\"),\n        regexp_replace(col(\"formulary_name\"), lit(\" +\"), lit(\"-\")),\n        lit(\".NULL_BASE_LINE.\"),\n        BUSINESS_DATE,\n        lit(\".dat\")\n      )\n    )\n    .when(\n      (col(\"carrier\") === lit(\"*ALL\")).and(isnull(col(\"run_eff_dt\"))),\n      concat(\n        AI_SERIAL_HOME,\n        lit(\"/deliver/.\"),\n        lit(\"/\"),\n        OUTPUT_FILE_PREFIX,\n        lit(\"form.C.\"),\n        ENV_NM,\n        lit(\".\"),\n        col(\"customer_name\"),\n        lit(\".\"),\n        regexp_replace(col(\"formulary_name\"), lit(\" +\"), lit(\"-\")),\n        lit(\".ALL_ALL_ALL.\"),\n        BUSINESS_DATE,\n        lit(\".dat\")\n      )\n    )\n    .when(\n      (col(\"carrier\") === lit(\"*ALL\")).and(!isnull(col(\"run_eff_dt\"))),\n      concat(\n        AI_SERIAL_HOME,\n        lit(\"/deliver/.\"),\n        lit(\"/\"),\n        OUTPUT_FILE_PREFIX,\n        lit(\"form.F.\"),\n        ENV_NM,\n        lit(\".\"),\n        col(\"customer_name\"),\n        lit(\".\"),\n        regexp_replace(col(\"formulary_name\"), lit(\" +\"), lit(\"-\")),\n        lit(\".ALL_ALL_ALL.\"),\n        BUSINESS_DATE,\n        lit(\".dat\")\n      )\n    )\n    .when(\n      (((!isnull(col(\"carrier\")))\n        .and(col(\"account\") === lit(\"*ALL\")))\n        .and(col(\"group\") === lit(\"*ALL\")))\n        .and(isnull(col(\"run_eff_dt\"))),\n      concat(\n        AI_SERIAL_HOME,\n        lit(\"/deliver/.\"),\n        lit(\"/\"),\n        OUTPUT_FILE_PREFIX,\n        lit(\"form.C.\"),\n        ENV_NM,\n        lit(\".\"),\n        col(\"customer_name\"),\n        lit(\".\"),\n        regexp_replace(col(\"formulary_name\"), lit(\" +\"), lit(\"-\")),\n        lit(\".\"),\n        col(\"carrier\"),\n        lit(\"_ALL_ALL.\"),\n        BUSINESS_DATE,\n        lit(\".dat\")\n      )\n    )\n    .when(\n      (((!isnull(col(\"carrier\")))\n        .and(col(\"account\") === lit(\"*ALL\")))\n        .and(col(\"group\") === lit(\"*ALL\")))\n        .and(!isnull(col(\"run_eff_dt\"))),\n      concat(\n        AI_SERIAL_HOME,\n        lit(\"/deliver/.\"),\n        lit(\"/\"),\n        OUTPUT_FILE_PREFIX,\n        lit(\"form.F.\"),\n        ENV_NM,\n        lit(\".\"),\n        col(\"customer_name\"),\n        lit(\".\"),\n        regexp_replace(col(\"formulary_name\"), lit(\" +\"), lit(\"-\")),\n        lit(\".\"),\n        col(\"carrier\"),\n        lit(\"_ALL_ALL.\"),\n        BUSINESS_DATE,\n        lit(\".dat\")\n      )\n    )\n    .when(\n      (((!isnull(col(\"carrier\")))\n        .and(!isnull(col(\"account\"))))\n        .and(col(\"group\") === lit(\"*ALL\")))\n        .and(isnull(col(\"run_eff_dt\"))),\n      concat(\n        AI_SERIAL_HOME,\n        lit(\"/deliver/.\"),\n        lit(\"/\"),\n        OUTPUT_FILE_PREFIX,\n        lit(\"form.C.\"),\n        ENV_NM,\n        lit(\".\"),\n        col(\"customer_name\"),\n        lit(\".\"),\n        regexp_replace(col(\"formulary_name\"), lit(\" +\"), lit(\"-\")),\n        lit(\".\"),\n        col(\"carrier\"),\n        lit(\"_\"),\n        col(\"account\"),\n        lit(\"_ALL.\"),\n        BUSINESS_DATE,\n        lit(\".dat\")\n      )\n    )\n    .when(\n      (((!isnull(col(\"carrier\")))\n        .and(!isnull(col(\"account\"))))\n        .and(col(\"group\") === lit(\"*ALL\")))\n        .and(!isnull(col(\"run_eff_dt\"))),\n      concat(\n        AI_SERIAL_HOME,\n        lit(\"/deliver/.\"),\n        lit(\"/\"),\n        OUTPUT_FILE_PREFIX,\n        lit(\"form.F.\"),\n        ENV_NM,\n        lit(\".\"),\n        col(\"customer_name\"),\n        lit(\".\"),\n        regexp_replace(col(\"formulary_name\"), lit(\" +\"), lit(\"-\")),\n        lit(\".\"),\n        col(\"carrier\"),\n        lit(\"_\"),\n        col(\"account\"),\n        lit(\"_ALL.\"),\n        BUSINESS_DATE,\n        lit(\".dat\")\n      )\n    )\n    .when(\n      isnull(col(\"run_eff_dt\")),\n      concat(\n        AI_SERIAL_HOME,\n        lit(\"/deliver/.\"),\n        lit(\"/\"),\n        OUTPUT_FILE_PREFIX,\n        lit(\"form.C.\"),\n        ENV_NM,\n        lit(\".\"),\n        col(\"customer_name\"),\n        lit(\".\"),\n        regexp_replace(col(\"formulary_name\"), lit(\" +\"), lit(\"-\")),\n        lit(\".\"),\n        col(\"carrier\"),\n        lit(\"_\"),\n        col(\"account\"),\n        lit(\"_\"),\n        col(\"group\"),\n        lit(\".\"),\n        BUSINESS_DATE,\n        lit(\".dat\")\n      )\n    )\n    .otherwise(\n      concat(\n        AI_SERIAL_HOME,\n        lit(\"/deliver/.\"),\n        lit(\"/\"),\n        OUTPUT_FILE_PREFIX,\n        lit(\"form.F.\"),\n        ENV_NM,\n        lit(\".\"),\n        col(\"customer_name\"),\n        lit(\".\"),\n        regexp_replace(col(\"formulary_name\"), lit(\" +\"), lit(\"-\")),\n        lit(\".\"),\n        col(\"carrier\"),\n        lit(\"_\"),\n        col(\"account\"),\n        lit(\"_\"),\n        col(\"group\"),\n        lit(\".\"),\n        BUSINESS_DATE,\n        lit(\".dat\")\n      )\n    )",
      "isAbInitioTranspilerImport" : true
    },
    "configuration" : {
      "common" : {
        "type" : "record",
        "fields" : [ {
          "name" : "EXTRACT_FILE",
          "kind" : {
            "type" : "string",
            "value" : ""
          },
          "optional" : false,
          "isWorkflowNodeConfiguration" : false,
          "isReferenced" : false
        }, {
          "name" : "AI_SERIAL_HOME",
          "kind" : {
            "type" : "string",
            "value" : ""
          },
          "optional" : false,
          "isWorkflowNodeConfiguration" : false,
          "isReferenced" : false
        }, {
          "name" : "FIRST_OF_NEXT_YEAR",
          "kind" : {
            "type" : "string",
            "value" : "20250101"
          },
          "optional" : false,
          "isWorkflowNodeConfiguration" : false,
          "isReferenced" : false
        }, {
          "name" : "CAG_OVRRD_REF_FILE",
          "kind" : {
            "type" : "string",
            "value" : "AI_SERIAL_HOME/deliver/./altexp_form_ovrrd_ref.dat"
          },
          "optional" : false,
          "isWorkflowNodeConfiguration" : false,
          "isReferenced" : false
        }, {
          "name" : "OUTPUT_FILE_PREFIX",
          "kind" : {
            "type" : "string",
            "value" : "altexp_ "
          },
          "optional" : false,
          "isWorkflowNodeConfiguration" : false,
          "isReferenced" : false
        }, {
          "name" : "ENV_NM",
          "kind" : {
            "type" : "string",
            "value" : "RXCL3-CTR"
          },
          "optional" : false,
          "isWorkflowNodeConfiguration" : false,
          "isReferenced" : false
        }, {
          "name" : "BUSINESS_DATE",
          "kind" : {
            "type" : "string",
            "value" : "20240401"
          },
          "optional" : false,
          "isWorkflowNodeConfiguration" : false,
          "isReferenced" : false
        } ]
      },
      "oldCommon" : {
        "type" : "record",
        "fields" : [ ]
      },
      "fabrics" : { },
      "instances" : { },
      "selected" : "default",
      "nonEditable" : [ ],
      "isSubscribedPipelineWithPipelineConfigs" : false
    },
    "sparkConf" : [ ],
    "hadoopConf" : [ ],
    "codeMode" : "sparse",
    "buildSystem" : "maven",
    "externalDependencies" : [ ],
    "dependentProjectExternalDependencies" : [ {
      "projectUID" : "12651",
      "projectName" : "ProphecySparkBasicsScala",
      "externalDependencies" : [ ]
    }, {
      "projectUID" : "12652",
      "projectName" : "ProphecyWarehouseScala",
      "externalDependencies" : [ ]
    } ],
    "isImported" : false,
    "interimMode" : "Full",
    "interimModeEnabled" : true,
    "visualCodeInterimMode" : "Disabled",
    "recordsLimit" : {
      "enabled" : false,
      "value" : 1000
    },
    "configurationVersion" : "v2"
  },
  "connections" : [ {
    "id" : "e7",
    "source" : "Reference_File_Creation",
    "sourcePort" : "Reference_File_Creation__out",
    "target" : "Reference_File",
    "targetPort" : "Reference_File__in"
  }, {
    "id" : "9-uNxyogB85wAXKeeaJFA",
    "source" : "IFIL_Extract_Data",
    "sourcePort" : "IFIL_Extract_Data__out",
    "target" : "VU1hNd3KEOYvYZpwbLmo4$$YD8wYSkM8kFYKI_zJ_HLh",
    "targetPort" : "hIFi0dfqiRjAToUOeVO6x$$JstmuvdeuSwVu_3h9VUg3"
  }, {
    "id" : "oS82D7CWybXVdzV8X3vDP",
    "source" : "VU1hNd3KEOYvYZpwbLmo4$$YD8wYSkM8kFYKI_zJ_HLh",
    "sourcePort" : "oBS0qmCB7y9TrzLZp9MPZ$$fcIFuVUWE3xZ3sO_Hrqmy",
    "target" : "pH3kiIHVc469Q5l-f8_nM$$PfpZGLpowNgr6nL3pjfY6",
    "targetPort" : "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT"
  }, {
    "id" : "EjpshO_-0CKmRCB47S6SG",
    "source" : "pH3kiIHVc469Q5l-f8_nM$$PfpZGLpowNgr6nL3pjfY6",
    "sourcePort" : "Oj3AEfUq5thukMRFhuyD0$$tVpyLe38F3M3g9WnRyOih",
    "target" : "JOR7RF_pLpWfITj9__OzK$$CzMxX1I3aI7KqCS07mD-n",
    "targetPort" : "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y"
  }, {
    "id" : "A25-UPa50QbNcGeMCrfTe$$rToXA9MzMgjp8lB0II7vx",
    "source" : "JOR7RF_pLpWfITj9__OzK$$CzMxX1I3aI7KqCS07mD-n",
    "sourcePort" : "uvUBLaII92Qu8ICwa2CFP$$p9oKAIHEWlNwJ8Ki_d7WT",
    "target" : "xJCRJrK531lUD-r0ixor_$$0Xn1uGEbxf5SHqy4Sw6-u",
    "targetPort" : "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW"
  }, {
    "id" : "QeTTwDEnLpPWIL8wEcfEP$$JMsdwTgW_cSCtuxf-CtUC",
    "source" : "xJCRJrK531lUD-r0ixor_$$0Xn1uGEbxf5SHqy4Sw6-u",
    "sourcePort" : "qlNaw_Hgmv4czkJRAmJDk$$xIaZHTHhC4qWw-68xu7tP",
    "target" : "UAkHIQpCD1I9xGDGA5ZA0$$ZvoB8gt_Xg8_LIBrNsw31",
    "targetPort" : "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7"
  }, {
    "id" : "OgrXRbe6Obs99lJO_173S",
    "source" : "UAkHIQpCD1I9xGDGA5ZA0$$ZvoB8gt_Xg8_LIBrNsw31",
    "sourcePort" : "MUkH6j_Ut3w4bkTyeWhOI$$YwyB3Cr4aVq3F5UTW1QxO",
    "target" : "PVmV1vYMgCajOAHDZnFEP$$HjN36Kn6UKbZ-xmYPbPjj",
    "targetPort" : "vx_hJQzh9xvcI0CcATuTE$$vJFdtu3ETb-THAcxarG_Q"
  }, {
    "id" : "VwbE6WIzQ7hMD9QYZtnQw$$ml3ssTMRZs7e1WQQ2LSzp",
    "source" : "5ewa_fB1AQfNonNSQk1lB$$5UXPacIRbrZyLnhYpUZss",
    "sourcePort" : "iSPfwBZ5iAow-zeqHc8nz$$xKN2rfkFDvksl6nD4QvI8",
    "target" : "UKVvU9xgnBy4-yC6Var38$$dRRhccM8WVdPwN2G5fb7h",
    "targetPort" : "SFmO10bjWgzvdxg2PcaM8$$5oywyMX46sjnLIYNk-Sq0"
  }, {
    "id" : "evDjnwIu_QbS8YitkfANp$$W7Vt_T7pa6wxMJjMyMaml",
    "source" : "UKVvU9xgnBy4-yC6Var38$$dRRhccM8WVdPwN2G5fb7h",
    "sourcePort" : "xbncaKoI-S3A5owdecx6o$$mwneTlfdnKhkujKeoox5v",
    "target" : "Y9KqWA23at7ntDQWNQkSF$$VirC34qqsXrUav4kJYjRI",
    "targetPort" : "76RKyl2ShVscPlhbVSATv$$oLwtP9ZmhLqKu9yZOCvyA"
  }, {
    "id" : "kT01TRqtNmkBK23761Unv$$AF7lVGUzjqWyFzW3sRMaH",
    "source" : "PVmV1vYMgCajOAHDZnFEP$$HjN36Kn6UKbZ-xmYPbPjj",
    "sourcePort" : "g7FwSGydrs5KSkl3KvtEK$$_Ez_jq2DjzaT11rZCPWa-",
    "target" : "1eC1z4KpfCzik-yeLzK47$$q7dmqKZWCZU6tvFH3xZLa",
    "targetPort" : "e7p6BOrRWYVaLAd1nwzRs$$Dsl6X5uM43sUhv0dRFQpy"
  }, {
    "id" : "4gPrFMOTeIw0TkO5GgmBh$$NcINiTegtr6B4JVOybbyc",
    "source" : "1eC1z4KpfCzik-yeLzK47$$q7dmqKZWCZU6tvFH3xZLa",
    "sourcePort" : "q2loU4ltGS0yvReNv4K_p$$_bsvtN0vCVh_Ew4o9K_Ho",
    "target" : "Write_Data_at_CAG_level",
    "targetPort" : "Write_Data_at_CAG_level__in"
  }, {
    "id" : "u6ZoKSsEDgoZ-_tgGqOuk",
    "source" : "Y9KqWA23at7ntDQWNQkSF$$VirC34qqsXrUav4kJYjRI",
    "sourcePort" : "EQETKLdF7iY2JiZLrAveb$$t4zLSTAEEPBvzhjIbhmVp",
    "target" : "Reference_File_Creation",
    "targetPort" : "Reference_File_Creation__in"
  }, {
    "id" : "pXcqkYQVJGt3T_m8uHHaz",
    "source" : "xJCRJrK531lUD-r0ixor_$$0Xn1uGEbxf5SHqy4Sw6-u",
    "sourcePort" : "qlNaw_Hgmv4czkJRAmJDk$$xIaZHTHhC4qWw-68xu7tP",
    "target" : "5ewa_fB1AQfNonNSQk1lB$$5UXPacIRbrZyLnhYpUZss",
    "targetPort" : "rHiZuN61U0MIMXUyUvAG_$$HoHec8MgbM7fCRG6gQOrQ"
  } ],
  "processes" : {
    "5ewa_fB1AQfNonNSQk1lB$$5UXPacIRbrZyLnhYpUZss" : {
      "id" : "5ewa_fB1AQfNonNSQk1lB$$5UXPacIRbrZyLnhYpUZss",
      "component" : "FlattenSchema",
      "metadata" : {
        "label" : "flatten_primary_data",
        "slug" : "flatten_primary_data",
        "x" : 1020,
        "y" : 20,
        "phase" : 0,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false,
        "comment" : "Flattens the primary data column in the input DataFrame, ensuring that each element in the primary data becomes a separate row in the output DataFrame.",
        "autoUpdateComment" : true
      },
      "ports" : {
        "inputs" : [ {
          "id" : "rHiZuN61U0MIMXUyUvAG_$$HoHec8MgbM7fCRG6gQOrQ",
          "slug" : "in",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : " run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "primary_data",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "formulary_name",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "carrier",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "account",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "group",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "customer_name",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "run_eff_dt",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_cd",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "ndc11",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_reqd_ind",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "specialty_ind",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier_desc",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status_desc",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_type_cd",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_type_cd",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : false
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_group_name",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : false
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_step_number",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : false
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "last_exp_dt",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ {
          "id" : "iSPfwBZ5iAow-zeqHc8nz$$xKN2rfkFDvksl6nD4QvI8",
          "slug" : "out"
        } ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : false,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "explodedColsNewName" : [ {
          "originalColToExplode" : "primary_data",
          "updatedColToExplode" : "primary_data",
          "colNameAfterExplode" : "primary_data"
        } ],
        "fsExpressions" : [ {
          "exploded" : "✓",
          "flattenedExpression" : "primary_data",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"primary_data\")"
          },
          "targetTokens" : [ "primary_data" ],
          "target" : "primary_data"
        } ],
        "columnsSelector" : [ "rHiZuN61U0MIMXUyUvAG_$$HoHec8MgbM7fCRG6gQOrQ##primary_data" ],
        "explodeColumns" : [ "primary_data" ],
        "delimiter" : "-"
      },
      "componentInfo" : {
        "gemId" : "gitUri=http://gitserver:3000/DxEheDCJ_team_5751/DxEheDCJ_project_12651.git&subPath=&tag=0.1.2&projectSubscriptionProjectId=12651&path=gems/FlattenSchema",
        "projectName" : "ProphecySparkBasicsScala"
      }
    },
    "IFIL_Extract_Data" : {
      "id" : "IFIL_Extract_Data",
      "component" : "Source",
      "metadata" : {
        "label" : "IFIL_Extract_Data",
        "slug" : "IFIL_Extract_Data",
        "x" : 20,
        "y" : 120,
        "phase" : 3,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false
      },
      "ports" : {
        "inputs" : [ ],
        "outputs" : [ {
          "id" : "IFIL_Extract_Data__out",
          "slug" : "out"
        } ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : false,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "datasetId" : "datasets/IFIL_Extract_Data"
      }
    },
    "Y9KqWA23at7ntDQWNQkSF$$VirC34qqsXrUav4kJYjRI" : {
      "id" : "Y9KqWA23at7ntDQWNQkSF$$VirC34qqsXrUav4kJYjRI",
      "component" : "Script",
      "metadata" : {
        "label" : "Create_Product_Crosswalk_For_Different_Levels_2",
        "slug" : "Create_Product_Crosswalk_For_Different_Levels_2",
        "x" : 1420,
        "y" : 20,
        "phase" : 3,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false,
        "comment" : "Creates a product crosswalk dataframe with additional data path information.",
        "autoUpdateComment" : true
      },
      "ports" : {
        "inputs" : [ {
          "id" : "76RKyl2ShVscPlhbVSATv$$oLwtP9ZmhLqKu9yZOCvyA",
          "slug" : "in0",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "carrier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "account",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "group",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "cag_priority",
              "type" : "integer",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ {
          "id" : "EQETKLdF7iY2JiZLrAveb$$t4zLSTAEEPBvzhjIbhmVp",
          "slug" : "out0",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "carrier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "account",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "group",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "cag_priority",
              "type" : "integer",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "data_path",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : true,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "script" : "val out0 = in0.withColumn(\"data_path\", \n                            op_fl_nn_condition(lit(Config.AI_SERIAL_HOME), \n                                                lit(Config.OUTPUT_FILE_PREFIX),\n                                                lit(Config.ENV_NM),\n                                                lit(Config.BUSINESS_DATE)))",
        "scriptMethodHeader" : "def apply(spark: SparkSession, in0: DataFrame): DataFrame = {",
        "scriptMethodFooter" : "    out0\n}"
      }
    },
    "Reference_File" : {
      "id" : "Reference_File",
      "component" : "Target",
      "metadata" : {
        "label" : "Reference_File",
        "slug" : "Reference_File",
        "x" : 1820,
        "y" : 20,
        "phase" : 3,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false
      },
      "ports" : {
        "inputs" : [ {
          "id" : "Reference_File__in",
          "slug" : "in",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "carrier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "account",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "group",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "is_future_snap",
              "type" : "integer",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "data_path",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "newline",
              "type" : "string",
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : false,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "datasetId" : "datasets/Reference_File"
      }
    },
    "JOR7RF_pLpWfITj9__OzK$$CzMxX1I3aI7KqCS07mD-n" : {
      "id" : "JOR7RF_pLpWfITj9__OzK$$CzMxX1I3aI7KqCS07mD-n",
      "component" : "Reformat",
      "metadata" : {
        "label" : "Accumulate_Products_for_each_CAG_and_Prioritize_Reformat_1",
        "slug" : "Accumulate_Products_for_each_CAG_and_Prioritize_Reformat_1",
        "x" : 620,
        "y" : 120,
        "phase" : 3,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false,
        "comment" : "Reformats and prioritizes product data for each customer account group, extracting relevant fields and structuring them based on their priority.",
        "autoUpdateComment" : true
      },
      "ports" : {
        "inputs" : [ {
          "id" : "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y",
          "slug" : "in",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "carrier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "account",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "group",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "data_path",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "cag_priority",
              "type" : "integer",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_cd",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "ndc11",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_reqd_ind",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "specialty_ind",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_ind",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier_desc",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status_desc",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_type_cd",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_type_cd",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_group_name",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_step_number",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "last_exp_dt",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "_id",
              "type" : "long",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ {
          "id" : "uvUBLaII92Qu8ICwa2CFP$$p9oKAIHEWlNwJ8Ki_d7WT",
          "slug" : "out"
        } ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : false,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "columnsSelector" : [ "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##_id", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##cag_priority", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##formulary_name", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##carrier", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##account", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##group", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##customer_name", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##run_eff_dt", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##formulary_cd", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##ndc11", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##formulary_tier", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##formulary_status", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##pa_reqd_ind", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##specialty_ind", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##step_therapy_ind", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##formulary_tier_desc", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##formulary_status_desc", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##pa_type_cd", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##step_therapy_type_cd", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##step_therapy_group_name", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##step_therapy_step_number", "wCkbsCBa1tIvO0IqbAORq$$PR16vSOnwaXIzSncTBL2y##last_exp_dt" ],
        "expressions" : [ {
          "target" : "primary_data",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(\n    col(\"_id\"),\n    col(\"cag_priority\"),\n    col(\"formulary_name\"),\n    col(\"carrier\"),\n    col(\"account\"),\n    col(\"group\"),\n    col(\"customer_name\"),\n    col(\"run_eff_dt\"),\n)"
          },
          "description" : ""
        }, {
          "target" : "formulary_cd",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"formulary_cd\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "ndc11",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"ndc11\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "formulary_tier",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"formulary_tier\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "formulary_status",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"formulary_status\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "pa_reqd_ind",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"pa_reqd_ind\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "specialty_ind",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"specialty_ind\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "step_therapy_ind",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"step_therapy_ind\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "formulary_tier_desc",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"formulary_tier_desc\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "formulary_status_desc",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"formulary_status_desc\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "pa_type_cd",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"pa_type_cd\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "step_therapy_type_cd",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"step_therapy_type_cd\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "step_therapy_group_name",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"step_therapy_group_name\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "step_therapy_step_number",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"step_therapy_step_number\"), x => x.getField(\"value\")).as(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "last_exp_dt",
          "expression" : {
            "format" : "scala",
            "expression" : "struct(col(\"_id\"), col(\"cag_priority\"), transform(col(\"last_exp_dt\"), x => x.getField(\"value\")).as(\"value\"))\n"
          },
          "description" : ""
        } ]
      },
      "componentInfo" : {
        "gemId" : "gitUri=http://gitserver:3000/DxEheDCJ_team_5751/DxEheDCJ_project_12651.git&subPath=&tag=0.1.2&projectSubscriptionProjectId=12651&path=gems/Reformat",
        "projectName" : "ProphecySparkBasicsScala"
      }
    },
    "1eC1z4KpfCzik-yeLzK47$$q7dmqKZWCZU6tvFH3xZLa" : {
      "id" : "1eC1z4KpfCzik-yeLzK47$$q7dmqKZWCZU6tvFH3xZLa",
      "component" : "Script",
      "metadata" : {
        "label" : "Normalize_CAG_Data_1",
        "slug" : "Normalize_CAG_Data_1",
        "x" : 1420,
        "y" : 220,
        "phase" : 3,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false,
        "comment" : "Normalizes CAG data by selecting specific columns and adding additional computed columns for further analysis.",
        "autoUpdateComment" : true
      },
      "ports" : {
        "inputs" : [ {
          "id" : "e7p6BOrRWYVaLAd1nwzRs$$Dsl6X5uM43sUhv0dRFQpy",
          "slug" : "in",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "carrier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "account",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "group",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "cag_priority",
              "type" : "integer",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "prdcts",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "formulary_cd",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "ndc11",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "formulary_tier",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "formulary_status",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "pa_reqd_ind",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "specialty_ind",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "step_therapy_ind",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "formulary_tier_desc",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "formulary_status_desc",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "pa_type_cd",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "step_therapy_type_cd",
                    "type" : "string",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "step_therapy_group_name",
                    "type" : "string",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "step_therapy_step_number",
                    "type" : "string",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "last_exp_dt",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "data_path",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ {
          "id" : "q2loU4ltGS0yvReNv4K_p$$_bsvtN0vCVh_Ew4o9K_Ho",
          "slug" : "out",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_cd",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "carrier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "account",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "group",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "last_exp_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "ndc11",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_reqd_ind",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "specialty_ind",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_ind",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier_desc",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status_desc",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_type_cd",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_type_cd",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_group_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_step_number",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "newline",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "data_path",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : true,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "script" : "val out = in.select(\n  col(\"formulary_name\"),\n  col(\"formulary_cd\"),\n  col(\"carrier\"),\n  col(\"account\"),\n  col(\"group\"),\n  col(\"last_exp_dt\"),\n  col(\"ndc11\"),\n  col(\"formulary_tier\"),\n  col(\"formulary_status\"),\n  col(\"pa_reqd_ind\"),\n  col(\"specialty_ind\"),\n  col(\"step_therapy_ind\"),\n  col(\"formulary_tier_desc\"),\n  col(\"formulary_status_desc\"),\n  col(\"pa_type_cd\"),\n  col(\"step_therapy_type_cd\"),\n  col(\"step_therapy_group_name\"),\n  col(\"step_therapy_step_number\"),\n  lit(\"\\n\").as(\"newline\"),\n  col(\"run_eff_dt\"),\n  col(\"customer_name\"),\n  op_fl_nn_condition(lit(Config.AI_SERIAL_HOME),\n    lit(Config.OUTPUT_FILE_PREFIX),\n    lit(Config.ENV_NM),\n    lit(Config.BUSINESS_DATE)).as(\"data_path\"),\n)",
        "scriptMethodHeader" : "def apply(spark: SparkSession, in: DataFrame): DataFrame = {",
        "scriptMethodFooter" : "    out\n}"
      }
    },
    "UAkHIQpCD1I9xGDGA5ZA0$$ZvoB8gt_Xg8_LIBrNsw31" : {
      "id" : "UAkHIQpCD1I9xGDGA5ZA0$$ZvoB8gt_Xg8_LIBrNsw31",
      "component" : "Reformat",
      "metadata" : {
        "label" : "reformatted_data",
        "slug" : "reformatted_data",
        "x" : 1020,
        "y" : 220,
        "phase" : 0,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false,
        "comment" : "Reformats the input data by selecting specific columns and transforming nested fields into separate columns.",
        "autoUpdateComment" : true
      },
      "ports" : {
        "inputs" : [ {
          "id" : "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7",
          "slug" : "in",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : " run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "primary_data",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "formulary_name",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "carrier",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "account",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "group",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "customer_name",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "run_eff_dt",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_cd",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "ndc11",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_reqd_ind",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "specialty_ind",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier_desc",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status_desc",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_type_cd",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_type_cd",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : false
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_group_name",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : false
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_step_number",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : false
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "last_exp_dt",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "value",
                    "type" : {
                      "type" : "array",
                      "elementType" : "string",
                      "containsNull" : true
                    },
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ {
          "id" : "MUkH6j_Ut3w4bkTyeWhOI$$YwyB3Cr4aVq3F5UTW1QxO",
          "slug" : "out"
        } ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : false,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "columnsSelector" : [ "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##primary_data", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##formulary_cd", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##ndc11", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##formulary_tier", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##formulary_status", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##pa_reqd_ind", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##specialty_ind", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##formulary_tier_desc", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##formulary_status_desc", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##pa_type_cd", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##step_therapy_type_cd", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##step_therapy_group_name", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##step_therapy_step_number", "XeEfFtgJjaquGoSWs9brf$$Z-aXQy0NlLAr8uvfF_pD7##last_exp_dt" ],
        "expressions" : [ {
          "target" : "primary_data",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"primary_data\")"
          },
          "description" : ""
        }, {
          "target" : "formulary_cd",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"formulary_cd\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "ndc11",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"ndc11\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "formulary_tier",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"formulary_tier\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "formulary_status",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"formulary_status\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "pa_reqd_ind",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"pa_reqd_ind\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "specialty_ind",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"specialty_ind\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "formulary_tier_desc",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"formulary_tier_desc\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "formulary_status_desc",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"formulary_status_desc\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "pa_type_cd",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"pa_type_cd\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "step_therapy_type_cd",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"step_therapy_type_cd\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "step_therapy_group_name",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"step_therapy_group_name\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "step_therapy_step_number",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"step_therapy_step_number\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        }, {
          "target" : "last_exp_dt",
          "expression" : {
            "format" : "scala",
            "expression" : "transform(col(\"last_exp_dt\"), x => x.getField(\"value\"))"
          },
          "description" : ""
        } ]
      },
      "componentInfo" : {
        "gemId" : "gitUri=http://gitserver:3000/DxEheDCJ_team_5751/DxEheDCJ_project_12651.git&subPath=&tag=0.1.2&projectSubscriptionProjectId=12651&path=gems/Reformat",
        "projectName" : "ProphecySparkBasicsScala"
      }
    },
    "Reference_File_Creation" : {
      "id" : "Reference_File_Creation",
      "component" : "Reformat",
      "metadata" : {
        "label" : "Reference_File_Creation",
        "slug" : "Reference_File_Creation",
        "x" : 1620,
        "y" : 20,
        "phase" : 3,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false
      },
      "ports" : {
        "inputs" : [ {
          "id" : "Reference_File_Creation__in",
          "slug" : "in",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "carrier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "account",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "group",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "cag_priority",
              "type" : "integer",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "data_path",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ {
          "id" : "Reference_File_Creation__out",
          "slug" : "out"
        } ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : false,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "columnsSelector" : [ ],
        "expressions" : [ {
          "target" : "formulary_name",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"formulary_name\")"
          },
          "description" : ""
        }, {
          "target" : "carrier",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"carrier\")"
          },
          "description" : ""
        }, {
          "target" : "account",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"account\")"
          },
          "description" : ""
        }, {
          "target" : "group",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"group\")"
          },
          "description" : ""
        }, {
          "target" : "customer_name",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"customer_name\")"
          },
          "description" : ""
        }, {
          "target" : "is_future_snap",
          "expression" : {
            "format" : "scala",
            "expression" : "when(!isnull(col(\"run_eff_dt\")).and(col(\"run_eff_dt\") === lit(Config.FIRST_OF_NEXT_YEAR)), lit(1))\n    .when(!isnull(col(\"run_eff_dt\")),                                                        lit(2))"
          },
          "description" : ""
        }, {
          "target" : "data_path",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"data_path\")"
          },
          "description" : ""
        }, {
          "target" : "run_eff_dt",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"run_eff_dt\")"
          },
          "description" : ""
        }, {
          "target" : "newline",
          "expression" : {
            "format" : "scala",
            "expression" : "coalesce(rpad(lit(\"\\n\"), 1, \" \"), lit(\"\\n\"))"
          },
          "description" : ""
        } ]
      },
      "componentInfo" : {
        "gemId" : "gitUri=http://gitserver:3000/DxEheDCJ_team_5751/DxEheDCJ_project_12651.git&subPath=&tag=0.1.2&projectSubscriptionProjectId=12651&path=gems/Reformat",
        "projectName" : "ProphecySparkBasicsScala"
      }
    },
    "xJCRJrK531lUD-r0ixor_$$0Xn1uGEbxf5SHqy4Sw6-u" : {
      "id" : "xJCRJrK531lUD-r0ixor_$$0Xn1uGEbxf5SHqy4Sw6-u",
      "component" : "Aggregate",
      "metadata" : {
        "label" : "aggregate_by_group",
        "slug" : "aggregate_by_group",
        "x" : 820,
        "y" : 120,
        "phase" : 0,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false,
        "comment" : "Aggregates data by grouping it based on formulary, customer, and effective date, consolidating various attributes into arrays.",
        "autoUpdateComment" : true
      },
      "ports" : {
        "inputs" : [ {
          "id" : "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW",
          "slug" : "in",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "primary_data",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "formulary_name",
                  "type" : "string",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "carrier",
                  "type" : "string",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "account",
                  "type" : "string",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "group",
                  "type" : "string",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "customer_name",
                  "type" : "string",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "run_eff_dt",
                  "type" : "string",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_cd",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : true
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "ndc11",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : true
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : true
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : true
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_reqd_ind",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : true
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "specialty_ind",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : true
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_ind",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : true
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier_desc",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : true
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status_desc",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : true
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_type_cd",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : true
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_type_cd",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : false
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_group_name",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : false
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_step_number",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : false
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "last_exp_dt",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "value",
                  "type" : {
                    "type" : "array",
                    "elementType" : "string",
                    "containsNull" : true
                  },
                  "nullable" : false,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ {
          "id" : "qlNaw_Hgmv4czkJRAmJDk$$xIaZHTHhC4qWw-68xu7tP",
          "slug" : "out"
        } ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : false,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "allIns" : false,
        "doPivot" : false,
        "aggregate" : [ {
          "_row_id" : "c_807",
          "target" : "primary_data",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(\n col(\"primary_data\")\n))"
          },
          "description" : ""
        }, {
          "target" : "formulary_cd",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"formulary_cd\")))"
          },
          "description" : ""
        }, {
          "target" : "ndc11",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"ndc11\")))"
          },
          "description" : ""
        }, {
          "target" : "formulary_tier",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"formulary_tier\")))"
          },
          "description" : ""
        }, {
          "target" : "formulary_status",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"formulary_status\")))"
          },
          "description" : ""
        }, {
          "target" : "pa_reqd_ind",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"pa_reqd_ind\")))"
          },
          "description" : ""
        }, {
          "target" : "specialty_ind",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"specialty_ind\")))"
          },
          "description" : ""
        }, {
          "target" : "formulary_tier_desc",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"formulary_tier_desc\")))"
          },
          "description" : ""
        }, {
          "target" : "formulary_status_desc",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"formulary_status_desc\")))"
          },
          "description" : ""
        }, {
          "target" : "pa_type_cd",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"pa_type_cd\")))"
          },
          "description" : ""
        }, {
          "target" : "step_therapy_type_cd",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"step_therapy_type_cd\")))"
          },
          "description" : ""
        }, {
          "target" : "step_therapy_group_name",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"step_therapy_group_name\")))"
          },
          "description" : ""
        }, {
          "target" : "step_therapy_step_number",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"step_therapy_step_number\")))"
          },
          "description" : ""
        }, {
          "target" : "last_exp_dt",
          "expression" : {
            "format" : "scala",
            "expression" : "array_sort(collect_list(col(\"last_exp_dt\")))"
          },
          "description" : ""
        } ],
        "allowSelection" : true,
        "pivotValues" : [ ],
        "activeTab" : "aggregate",
        "columnsSelector" : [ "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##primary_data", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##primary_data.formulary_name", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##primary_data.customer_name", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##primary_data.run_eff_dt", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##formulary_cd", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##ndc11", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##formulary_tier", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##formulary_status", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##pa_reqd_ind", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##specialty_ind", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##formulary_tier_desc", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##formulary_status_desc", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##pa_type_cd", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##step_therapy_type_cd", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##step_therapy_group_name", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##step_therapy_step_number", "32MkPWAot85Eaxn5NoRsI$$m3lCZFL1L-FKxreLpTwkW##last_exp_dt" ],
        "groupBy" : [ {
          "_row_id" : "c_781",
          "target" : "formulary_name",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"primary_data.formulary_name\")"
          },
          "description" : ""
        }, {
          "_row_id" : "c_787",
          "target" : "customer_name",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"primary_data.customer_name\")"
          },
          "description" : ""
        }, {
          "_row_id" : "c_792",
          "target" : " run_eff_dt",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"primary_data.run_eff_dt\")"
          },
          "description" : ""
        } ]
      },
      "componentInfo" : {
        "gemId" : "gitUri=http://gitserver:3000/DxEheDCJ_team_5751/DxEheDCJ_project_12651.git&subPath=&tag=0.1.2&projectSubscriptionProjectId=12651&path=gems/Aggregate",
        "projectName" : "ProphecySparkBasicsScala"
      }
    },
    "UKVvU9xgnBy4-yC6Var38$$dRRhccM8WVdPwN2G5fb7h" : {
      "id" : "UKVvU9xgnBy4-yC6Var38$$dRRhccM8WVdPwN2G5fb7h",
      "component" : "Reformat",
      "metadata" : {
        "label" : "reformat_primary_data",
        "slug" : "reformat_primary_data",
        "x" : 1220,
        "y" : 20,
        "phase" : 0,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false,
        "comment" : "Extracts specific columns from the primary data, reformatting them for further analysis.",
        "autoUpdateComment" : true
      },
      "ports" : {
        "inputs" : [ {
          "id" : "SFmO10bjWgzvdxg2PcaM8$$5oywyMX46sjnLIYNk-Sq0",
          "slug" : "in",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "primary_data",
              "type" : {
                "type" : "struct",
                "fields" : [ {
                  "name" : "_id",
                  "type" : "long",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "cag_priority",
                  "type" : "integer",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "formulary_name",
                  "type" : "string",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "carrier",
                  "type" : "string",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "account",
                  "type" : "string",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "group",
                  "type" : "string",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "customer_name",
                  "type" : "string",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                }, {
                  "name" : "run_eff_dt",
                  "type" : "string",
                  "nullable" : true,
                  "metadata" : {
                    "description" : "",
                    "mappings" : [ ],
                    "tags" : [ ]
                  }
                } ]
              },
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ {
          "id" : "xbncaKoI-S3A5owdecx6o$$mwneTlfdnKhkujKeoox5v",
          "slug" : "out"
        } ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : false,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "columnsSelector" : [ "SFmO10bjWgzvdxg2PcaM8$$5oywyMX46sjnLIYNk-Sq0##primary_data", "SFmO10bjWgzvdxg2PcaM8$$5oywyMX46sjnLIYNk-Sq0##primary_data.formulary_name", "SFmO10bjWgzvdxg2PcaM8$$5oywyMX46sjnLIYNk-Sq0##primary_data.carrier", "SFmO10bjWgzvdxg2PcaM8$$5oywyMX46sjnLIYNk-Sq0##primary_data.account", "SFmO10bjWgzvdxg2PcaM8$$5oywyMX46sjnLIYNk-Sq0##primary_data.group", "SFmO10bjWgzvdxg2PcaM8$$5oywyMX46sjnLIYNk-Sq0##primary_data.customer_name", "SFmO10bjWgzvdxg2PcaM8$$5oywyMX46sjnLIYNk-Sq0##primary_data.run_eff_dt", "SFmO10bjWgzvdxg2PcaM8$$5oywyMX46sjnLIYNk-Sq0##primary_data.cag_priority" ],
        "expressions" : [ {
          "target" : "formulary_name",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"primary_data.formulary_name\")"
          },
          "description" : ""
        }, {
          "target" : "carrier",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"primary_data.carrier\")"
          },
          "description" : ""
        }, {
          "target" : "account",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"primary_data.account\")"
          },
          "description" : ""
        }, {
          "target" : "group",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"primary_data.group\")"
          },
          "description" : ""
        }, {
          "target" : "customer_name",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"primary_data.customer_name\")"
          },
          "description" : ""
        }, {
          "target" : "run_eff_dt",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"primary_data.run_eff_dt\")"
          },
          "description" : ""
        }, {
          "target" : "cag_priority",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"primary_data.cag_priority\")"
          },
          "description" : ""
        } ]
      },
      "componentInfo" : {
        "gemId" : "gitUri=http://gitserver:3000/DxEheDCJ_team_5751/DxEheDCJ_project_12651.git&subPath=&tag=0.1.2&projectSubscriptionProjectId=12651&path=gems/Reformat",
        "projectName" : "ProphecySparkBasicsScala"
      }
    },
    "VU1hNd3KEOYvYZpwbLmo4$$YD8wYSkM8kFYKI_zJ_HLh" : {
      "id" : "VU1hNd3KEOYvYZpwbLmo4$$YD8wYSkM8kFYKI_zJ_HLh",
      "component" : "SchemaTransform",
      "metadata" : {
        "label" : "add_id_column",
        "slug" : "add_id_column",
        "x" : 220,
        "y" : 120,
        "phase" : 0,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false,
        "comment" : "Adds a unique identifier column to the DataFrame.",
        "autoUpdateComment" : true
      },
      "ports" : {
        "inputs" : [ {
          "id" : "hIFi0dfqiRjAToUOeVO6x$$JstmuvdeuSwVu_3h9VUg3",
          "slug" : "in",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "formulary_data_set_id",
              "type" : "decimal(10,0)",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_id",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_cd",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "carrier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "account",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "group",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "rxclaim_env_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "last_exp_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_data_set_dtl_id",
              "type" : "decimal(10,0)",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "ndc11",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_reqd_ind",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "specialty_ind",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_ind",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier_desc",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status_desc",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_type_cd",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_type_cd",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_group_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_step_number",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "newline",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ {
          "id" : "oBS0qmCB7y9TrzLZp9MPZ$$fcIFuVUWE3xZ3sO_Hrqmy",
          "slug" : "out"
        } ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : false,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "columnsSelector" : [ ],
        "transformations" : [ {
          "kind" : "AddReplaceColumn",
          "AddReplaceColumn" : {
            "sourceColumn" : "_id",
            "expression" : {
              "format" : "scala",
              "expression" : "monotonically_increasing_id()"
            }
          },
          "DropColumn" : {
            "sourceColumn" : ""
          },
          "RenameColumn" : {
            "sourceColumn" : "",
            "targetColumn" : ""
          }
        } ]
      },
      "componentInfo" : {
        "gemId" : "gitUri=http://gitserver:3000/DxEheDCJ_team_5751/DxEheDCJ_project_12651.git&subPath=&tag=0.1.2&projectSubscriptionProjectId=12651&path=gems/SchemaTransform",
        "projectName" : "ProphecySparkBasicsScala"
      }
    },
    "pH3kiIHVc469Q5l-f8_nM$$PfpZGLpowNgr6nL3pjfY6" : {
      "id" : "pH3kiIHVc469Q5l-f8_nM$$PfpZGLpowNgr6nL3pjfY6",
      "component" : "Aggregate",
      "metadata" : {
        "label" : "Accumulate_Products_for_each_CAG_and_Prioritize_1",
        "slug" : "Accumulate_Products_for_each_CAG_and_Prioritize_1",
        "x" : 420,
        "y" : 120,
        "phase" : 3,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false,
        "comment" : "Aggregates and prioritizes product information for each carrier, account, and group, based on various criteria. The result includes the latest formulary name, customer name, effective date, data path, and other attributes. The prioritization is determined based on specific conditions and assigns a priority value. The product information is sorted and collected into arrays for each attribute.",
        "autoUpdateComment" : true
      },
      "ports" : {
        "inputs" : [ {
          "id" : "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT",
          "slug" : "in",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "formulary_data_set_id",
              "type" : "decimal(10,0)",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_id",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_cd",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "carrier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "account",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "group",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "rxclaim_env_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "last_exp_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_data_set_dtl_id",
              "type" : "decimal(10,0)",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "ndc11",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_reqd_ind",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "specialty_ind",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_ind",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier_desc",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status_desc",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_type_cd",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_type_cd",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_group_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_step_number",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "newline",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "_id",
              "type" : "long",
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ {
          "id" : "Oj3AEfUq5thukMRFhuyD0$$tVpyLe38F3M3g9WnRyOih",
          "slug" : "out"
        } ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : false,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "allIns" : false,
        "doPivot" : false,
        "aggregate" : [ {
          "target" : "formulary_name",
          "expression" : {
            "format" : "scala",
            "expression" : "last(col(\"formulary_name\"))"
          },
          "description" : ""
        }, {
          "target" : "customer_name",
          "expression" : {
            "format" : "scala",
            "expression" : "last(col(\"customer_name\"))"
          },
          "description" : ""
        }, {
          "target" : "run_eff_dt",
          "expression" : {
            "format" : "scala",
            "expression" : "last(col(\"run_eff_dt\"))"
          },
          "description" : ""
        }, {
          "target" : "data_path",
          "expression" : {
            "format" : "scala",
            "expression" : "max(lit(\"\"))"
          },
          "description" : ""
        }, {
          "target" : "cag_priority",
          "expression" : {
            "format" : "scala",
            "expression" : "when(max(isnull(col(\"carrier\"))),            max(lit(1)))\n    .when(max(col(\"carrier\") === lit(\"*ALL\")), max(lit(2)))\n    .when(max(((!isnull(col(\"carrier\"))).and(col(\"account\") === lit(\"*ALL\"))).and(col(\"group\") === lit(\"*ALL\"))),\n          max(lit(3))\n    )\n    .when(max(((!isnull(col(\"carrier\"))).and(!isnull(col(\"account\")))).and(col(\"group\") === lit(\"*ALL\"))), max(lit(4)))\n    .otherwise(max(lit(5)))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_375",
          "target" : "formulary_cd",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), col(\"formulary_cd\").as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_390",
          "target" : "ndc11",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), col(\"ndc11\").as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_393",
          "target" : "formulary_tier",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), col(\"formulary_tier\").as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_396",
          "target" : "formulary_status",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), col(\"formulary_status\").as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_399",
          "target" : "pa_reqd_ind",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), col(\"pa_reqd_ind\").as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_402",
          "target" : "specialty_ind",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), col(\"specialty_ind\").as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_405",
          "target" : "step_therapy_ind",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), col(\"step_therapy_ind\").as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_408",
          "target" : "formulary_tier_desc",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), col(\"formulary_tier_desc\").as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_411",
          "target" : "formulary_status_desc",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), col(\"formulary_status_desc\").as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_414",
          "target" : "pa_type_cd",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), col(\"pa_type_cd\").as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_417",
          "target" : "step_therapy_type_cd",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), coalesce(col(\"step_therapy_type_cd\"),                      lit(\"\")).as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_420",
          "target" : "step_therapy_group_name",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), coalesce(col(\"step_therapy_group_name\"),                   lit(\"\")).as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_423",
          "target" : "step_therapy_step_number",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), coalesce(col(\"step_therapy_step_number\").cast(StringType), lit(\"\")).as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_426",
          "target" : "last_exp_dt",
          "expression" : {
            "format" : "scala",
            "expression" : "sort_array(collect_list(struct(col(\"_id\"), col(\"last_exp_dt\").as(\"value\"))))"
          },
          "description" : ""
        }, {
          "_row_id" : "c_692",
          "target" : "_id",
          "expression" : {
            "format" : "scala",
            "expression" : "last(col(\"_id\"))"
          },
          "description" : ""
        } ],
        "allowSelection" : true,
        "pivotValues" : [ ],
        "activeTab" : "aggregate",
        "columnsSelector" : [ "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##carrier", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##account", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##group", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##formulary_name", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##customer_name", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##run_eff_dt", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##_id", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##formulary_cd", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##ndc11", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##formulary_tier", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##formulary_status", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##pa_reqd_ind", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##specialty_ind", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##step_therapy_ind", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##formulary_tier_desc", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##formulary_status_desc", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##pa_type_cd", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##step_therapy_type_cd", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##step_therapy_group_name", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##step_therapy_step_number", "RLn96ATi6I6JSFQ7ubZwo$$7wZX8iaT4QZIOWdPYgIiT##last_exp_dt" ],
        "groupBy" : [ {
          "target" : "carrier",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"carrier\")"
          },
          "description" : ""
        }, {
          "target" : "account",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"account\")"
          },
          "description" : ""
        }, {
          "target" : "group",
          "expression" : {
            "format" : "scala",
            "expression" : "col(\"group\")"
          },
          "description" : ""
        } ]
      },
      "componentInfo" : {
        "gemId" : "gitUri=http://gitserver:3000/DxEheDCJ_team_5751/DxEheDCJ_project_12651.git&subPath=&tag=0.1.2&projectSubscriptionProjectId=12651&path=gems/Aggregate",
        "projectName" : "ProphecySparkBasicsScala"
      }
    },
    "Write_Data_at_CAG_level" : {
      "id" : "Write_Data_at_CAG_level",
      "component" : "Script",
      "metadata" : {
        "label" : "Write_Data_at_CAG_level",
        "slug" : "Write_Data_at_CAG_level",
        "x" : 1620,
        "y" : 220,
        "phase" : 3,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false
      },
      "ports" : {
        "inputs" : [ {
          "id" : "Write_Data_at_CAG_level__in",
          "slug" : "in",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_cd",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "carrier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "account",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "group",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "last_exp_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "ndc11",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_reqd_ind",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "specialty_ind",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_ind",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier_desc",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status_desc",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_type_cd",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_type_cd",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_group_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_step_number",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "newline",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "data_path",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : true,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "script" : "  val withFileDF = in.withColumn(\"fileName\", col(\"data_path\"))\n  withFileDF.breakAndWriteDataFrameForOutputFile(List(\n      \"formulary_name\",\n      \"formulary_cd\",\n      \"carrier\",\n      \"account\",\n      \"group\",\n      \"last_exp_dt\",\n      \"ndc11\",\n      \"formulary_tier\",\n      \"formulary_status\",\n      \"pa_reqd_ind\",\n      \"specialty_ind\",\n      \"step_therapy_ind\",\n      \"formulary_tier_desc\",\n      \"formulary_status_desc\",\n      \"pa_type_cd\",\n      \"step_therapy_type_cd\",\n      \"step_therapy_group_name\",\n      \"step_therapy_step_number\",\n      \"newline\",\n      \"run_eff_dt\",\n      \"customer_name\",\n      \"data_path\"\n  ), \"fileName\", \"csv\", Some(\"\\\\x01\"))\n\n",
        "scriptMethodHeader" : "def apply(spark: SparkSession, in: DataFrame): Unit = {",
        "scriptMethodFooter" : "    \n}"
      }
    },
    "PVmV1vYMgCajOAHDZnFEP$$HjN36Kn6UKbZ-xmYPbPjj" : {
      "id" : "PVmV1vYMgCajOAHDZnFEP$$HjN36Kn6UKbZ-xmYPbPjj",
      "component" : "Script",
      "metadata" : {
        "label" : "Create_Product_Crosswalk_For_Different_Levels_1",
        "slug" : "Create_Product_Crosswalk_For_Different_Levels_1",
        "x" : 1220,
        "y" : 220,
        "phase" : 3,
        "cache" : false,
        "detailedStats" : false,
        "isImported" : false,
        "comment" : "Generates a detailed product mapping for different levels of formulary data, prioritizing based on specific criteria.",
        "autoUpdateComment" : true
      },
      "ports" : {
        "inputs" : [ {
          "id" : "vx_hJQzh9xvcI0CcATuTE$$vJFdtu3ETb-THAcxarG_Q",
          "slug" : "in0",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "primary_data",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "_id",
                    "type" : "long",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "cag_priority",
                    "type" : "integer",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "formulary_name",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "carrier",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "account",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "group",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "customer_name",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "run_eff_dt",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_cd",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : true
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "ndc11",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : true
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : true
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : true
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_reqd_ind",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : true
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "specialty_ind",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : true
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_tier_desc",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : true
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "formulary_status_desc",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : true
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "pa_type_cd",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : true
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_type_cd",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : false
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_group_name",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : false
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "step_therapy_step_number",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : false
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "last_exp_dt",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "array",
                  "elementType" : "string",
                  "containsNull" : true
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "outputs" : [ {
          "id" : "g7FwSGydrs5KSkl3KvtEK$$_Ez_jq2DjzaT11rZCPWa-",
          "slug" : "out0",
          "schema" : {
            "type" : "struct",
            "fields" : [ {
              "name" : "formulary_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "carrier",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "account",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "group",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "customer_name",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "run_eff_dt",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "cag_priority",
              "type" : "integer",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "prdcts",
              "type" : {
                "type" : "array",
                "elementType" : {
                  "type" : "struct",
                  "fields" : [ {
                    "name" : "formulary_cd",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "ndc11",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "formulary_tier",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "formulary_status",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "pa_reqd_ind",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "specialty_ind",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "step_therapy_ind",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "formulary_tier_desc",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "formulary_status_desc",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "pa_type_cd",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "step_therapy_type_cd",
                    "type" : "string",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "step_therapy_group_name",
                    "type" : "string",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "step_therapy_step_number",
                    "type" : "string",
                    "nullable" : false,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  }, {
                    "name" : "last_exp_dt",
                    "type" : "string",
                    "nullable" : true,
                    "metadata" : {
                      "description" : "",
                      "mappings" : [ ],
                      "tags" : [ ]
                    }
                  } ]
                },
                "containsNull" : false
              },
              "nullable" : false,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            }, {
              "name" : "data_path",
              "type" : "string",
              "nullable" : true,
              "metadata" : {
                "description" : "",
                "mappings" : [ ],
                "tags" : [ ]
              }
            } ]
          },
          "isStreaming" : false
        } ],
        "selectedInputFields" : [ ],
        "isCustomOutputSchema" : true,
        "autoUpdateOnRun" : false
      },
      "properties" : {
        "script" : "    import _root_.io.prophecy.abinitio.ScalaFunctions._\n\n    def process_udf(\n                     primary_data: Seq[Row],\n                     _formulary_cd: Seq[Seq[String]],\n                     _ndc11: Seq[Seq[String]],\n                     _formulary_tier: Seq[Seq[String]],\n                     _formulary_status: Seq[Seq[String]],\n                     _pa_reqd_ind: Seq[Seq[String]],\n                     _specialty_ind: Seq[Seq[String]],\n                     _formulary_tier_desc: Seq[Seq[String]],\n                     _formulary_status_desc: Seq[Seq[String]],\n                     _pa_type_cd: Seq[Seq[String]],\n                     _step_therapy_ind: Seq[Seq[String]],\n                     _step_therapy_type_cd: Seq[Seq[String]],\n                     _step_therapy_group_name: Seq[Seq[String]],\n                     _step_therapy_step_number: Seq[Seq[String]],\n                     _last_exp_dt: Seq[Seq[String]]\n                   ) = {\n      val outputRows = scala.collection.mutable.ArrayBuffer[Row]()\n      var baseline_prdcts = Array[Row]()\n      var tarall_prdcts = Array[Row]()\n      var c_prdcts = Array[Row]()\n      var ca_prdcts = Array[Row]()\n      var prdcts = Array[Row]()\n      var starall_prdcts = Array[Row]()\n      var _products = Array[Row]()\n\n      primary_data.zipWithIndex.foreach { case (in, idx) =>\n        val len = _formulary_cd(idx).length\n        val in_prds = (0 until len).map { jdx =>\n          Row(_formulary_cd(idx)(jdx),\n            _ndc11(idx)(jdx),\n            _formulary_tier(idx)(jdx),\n            _formulary_status(idx)(jdx),\n            _pa_reqd_ind(idx)(jdx),\n            _specialty_ind(idx)(jdx),\n            _formulary_tier_desc(idx)(jdx),\n            _formulary_status_desc(idx)(jdx),\n            _pa_type_cd(idx)(jdx),\n            _step_therapy_ind(idx)(jdx),\n            _step_therapy_type_cd(idx)(jdx),\n            _step_therapy_group_name(idx)(jdx),\n            _step_therapy_step_number(idx)(jdx),\n            _last_exp_dt(idx)(jdx))\n        }.toArray\n        val cag_priority = in.getAs[Int](1)\n        if (cag_priority == 1) {\n          baseline_prdcts = in_prds\n          prdcts = baseline_prdcts\n        } else if (cag_priority == 2) {\n          starall_prdcts = Array.concat(baseline_prdcts.filter { x =>\n            in_prds.filter(y => (y.getAs[String](1) == x.getAs[String](1) && y.getAs[String](11) == x.getAs[String](11))).isEmpty\n          }.distinct,\n            in_prds\n          )\n          prdcts = starall_prdcts\n        } else if (cag_priority == 3) {\n          prdcts =\n            if (compareTo(starall_prdcts.length, 0) > 0)\n              Array.concat(starall_prdcts.filter(x => in_prds.filter(y => (y.getAs[String](1) == x.getAs[String](1) && y.getAs[String](11) == x.getAs[String](11))).isEmpty).distinct,\n                in_prds.toArray\n              )\n            else\n              Array.concat(baseline_prdcts.filter(x => in_prds.filter(y => (y.getAs[String](1) == x.getAs[String](1) && y.getAs[String](11) == x.getAs[String](11))).isEmpty).distinct,\n                in_prds\n              )\n          c_prdcts = Array.concat(c_prdcts, Array.fill(1)(Row(in.getAs[String](3), in_prds)))\n        } else if (cag_priority == 4) {\n          prdcts = if (compareTo(c_prdcts.length, 0) > 0) {\n            if (\n              (try {\n                (c_prdcts\n                  .filter(xx => xx.getAs[String](0) == in.getAs[String](3))\n                  .toArray).head\n                  .getAs[Seq[Row]](1).toArray\n              } catch {\n                case error: Throwable => null\n              }) != null\n            )\n              (c_prdcts\n                .filter(xx => xx.getAs[String](0) == in.getAs[String](3))\n                .toArray).head\n                .getAs[Seq[Row]](1).toArray\n            else\n              Array[Row]()\n          } else\n            Array[Row]()\n          _products = Array.concat(\n            prdcts.filter(x => in_prds.filter(y => (y.getAs[String](1) == x.getAs[String](1) && y.getAs[String](11) == x.getAs[String](11))).isEmpty).distinct,\n            in_prds.toArray\n          )\n          prdcts = if (compareTo(starall_prdcts.length, 0) > 0) {\n            Array.concat(\n              starall_prdcts.filter {\n                x =>\n                  _products.filter(y => (y.getAs[String](1) == x.getAs[String](1) && y.getAs[String](11) == x.getAs[String](11))).isEmpty\n              }.distinct,\n              _products\n            )\n          } else {\n            Array.concat(\n              baseline_prdcts.filter {\n                x =>\n                  _products.filter(y => (y.getAs[String](1) == x.getAs[String](1) && y.getAs[String](11) == x.getAs[String](11))).isEmpty\n              }.distinct,\n              _products\n            )\n          }\n          ca_prdcts = Array.concat(\n            ca_prdcts,\n            Array.fill(1)(\n              Row(\n                in.getAs[String](3),\n                in.getAs[String](4),\n                _products\n              )\n            )\n          )\n        } else if (cag_priority == 5) {\n          prdcts = if (compareTo(ca_prdcts.length, 0) > 0) {\n            if (\n              (try {\n                (ca_prdcts\n                  .filter { xx =>\n                    (xx.getAs[String](0) == in.getAs[String](3)) && (xx.getAs[String](1) == in.getAs[String](4))\n                  }\n                  .toArray).head\n                  .getAs[Seq[Row]](2).toArray\n              } catch {\n                case error: Throwable => null\n              }) != null\n            )\n              (ca_prdcts\n                .filter { xx =>\n                  (xx.getAs[String](0) == in.getAs[String](3)) && (xx.getAs[String](1) == in.getAs[String](4))\n                }\n                .toArray).head\n                .getAs[Seq[Row]](2).toArray\n            else\n              Array[Row]()\n          } else\n            Array[Row]()\n          if ((prdcts.length == 0) && (compareTo(c_prdcts.length, 0) > 0)) {\n            prdcts =\n              if (\n                (try {\n                  (c_prdcts\n                    .filter(xx => xx.getAs[String](0) == in.getAs[String](3))\n                    .toArray).head\n                    .getAs[Seq[Row]](1).toArray\n                } catch {\n                  case error: Throwable => null\n                }) != null\n              )\n                (c_prdcts\n                  .filter(xx => xx.getAs[String](0) == in.getAs[String](3))\n                  .toArray).head\n                  .getAs[Seq[Row]](1).toArray\n              else\n                Array[Row]()\n          }\n          _products = Array.concat(\n            prdcts.filter(x => in_prds.filter(y => (y.getAs[String](1) == x.getAs[String](1) && y.getAs[String](11) == x.getAs[String](11))).isEmpty).distinct,\n            in_prds\n          )\n          prdcts = if (compareTo(starall_prdcts.length, 0) > 0) {\n            Array.concat(\n              starall_prdcts.filter {\n                x =>\n                  _products.filter(y => (y.getAs[String](1) == x.getAs[String](1) && y.getAs[String](11) == x.getAs[String](11))).isEmpty\n              }.distinct,\n              _products\n            )\n          } else {\n            Array.concat(\n              baseline_prdcts.filter {\n                x =>\n                  _products.filter(y => (y.getAs[String](1) == x.getAs[String](1) && y.getAs[String](11) == x.getAs[String](11))).isEmpty\n              }.distinct,\n              _products\n            )\n          }\n        }\n        prdcts.foreach { prd =>\n          outputRows.append(Row(\n            in.getAs[String](2),\n            in.getAs[String](3),\n            in.getAs[String](4),\n            in.getAs[String](5),\n            in.getAs[String](6),\n            in.getAs[String](7),\n            in.getAs[Int](1),\n            prd.getAs[String](0),\n            prd.getAs[String](1),\n            prd.getAs[String](2),\n            prd.getAs[String](3),\n            prd.getAs[String](4),\n            prd.getAs[String](5),\n            prd.getAs[String](6),\n            prd.getAs[String](7),\n            prd.getAs[String](8),\n            prd.getAs[String](9),\n            prd.getAs[String](10),\n            prd.getAs[String](11),\n            prd.getAs[String](12),\n            prd.getAs[String](13)\n          ))\n        }\n      }\n      outputRows.toList\n    }\n\n\n    val schema = StructType(List(\n      StructField(\"formulary_name\", StringType, false),\n      StructField(\"carrier\", StringType, false),\n      StructField(\"account\", StringType, false),\n      StructField(\"group\", StringType, false),\n      StructField(\"customer_name\", StringType, false),\n      StructField(\"run_eff_dt\", StringType, false),\n      StructField(\"cag_priority\", IntegerType, false),\n      StructField(\"formulary_cd\", StringType, false),\n      StructField(\"ndc11\", StringType, false),\n      StructField(\"formulary_tier\", StringType, false),\n      StructField(\"formulary_status\", StringType, false),\n      StructField(\"pa_reqd_ind\", StringType, false),\n      StructField(\"specialty_ind\", StringType, false),\n      StructField(\"step_therapy_ind\", StringType, false),\n      StructField(\"formulary_tier_desc\", StringType, false),\n      StructField(\"formulary_status_desc\", StringType, false),\n      StructField(\"pa_type_cd\", StringType, false),\n      StructField(\"step_therapy_type_cd\", StringType, false),\n      StructField(\"step_therapy_group_name\", StringType, false),\n      StructField(\"step_therapy_step_number\", StringType, false),\n      StructField(\"last_exp_dt\", StringType, false)\n    ))\n\n\n    val resultRDD = in0.rdd.flatMap(row => process_udf(\n      row.getAs[Seq[Row]](0),\n      row.getAs[Seq[Seq[String]]](1),\n      row.getAs[Seq[Seq[String]]](2),\n      row.getAs[Seq[Seq[String]]](3),\n      row.getAs[Seq[Seq[String]]](4),\n      row.getAs[Seq[Seq[String]]](5),\n      row.getAs[Seq[Seq[String]]](6),\n      row.getAs[Seq[Seq[String]]](7),\n      row.getAs[Seq[Seq[String]]](8),\n      row.getAs[Seq[Seq[String]]](9),\n      row.getAs[Seq[Seq[String]]](10),\n      row.getAs[Seq[Seq[String]]](11),\n      row.getAs[Seq[Seq[String]]](12),\n      row.getAs[Seq[Seq[String]]](13),\n      row.getAs[Seq[Seq[String]]](14),\n    ))\n    val out0 = spark.createDataFrame(resultRDD, schema)",
        "scriptMethodHeader" : "def apply(spark: SparkSession, in0: DataFrame): DataFrame = {",
        "scriptMethodFooter" : "    out0\n}"
      }
    }
  },
  "ports" : {
    "inputs" : [ ],
    "outputs" : [ ],
    "selectedInputFields" : [ ],
    "isCustomOutputSchema" : false,
    "autoUpdateOnRun" : false
  }
}